LIBNAME = libccnl-unix.a

CCNL_DEFINES = -DCCNL_UNIX -DUSE_CCNxDIGEST -DUSE_DUP_CHECK -DUSE_ECHO \
					-DUSE_HMAC256 -DUSE_IPV4 \
					-DUSE_IPV6 -DUSE_MGMT -DUSE_NFN_NSTRANS -DUSE_STATS -DUSE_UNIXSOCKET \
					-DNEEDS_PREFIX_MATCHING -DUSE_LOGGING

CCNL_PACKET_FORMATS = -DUSE_SUITE_CCNB -DUSE_SUITE_CCNTLV -DUSE_SUITE_CISTLV \
						-DUSE_SUITE_IOTTLV -DUSE_SUITE_NDNTLV -DUSE_SUITE_LOCALRPC


CCNL_DISABLED_FLAGS = USE_LINKLAYER USE_DEBUG USE_DEBUG_MALLOC USE_FRAG \
						USE_NACK USE_NFN USE_NFN_MONITOR USE_NFN_KEEPALIVE \
						USE_NFN_PULL USE_SCHEDULER USE_SIGNATURES -DUSE_HTTP_STATUS

CCNLCFLAGS = $(CCNL_DEFINES) $(CCNL_PACKET_FORMATS)
INCLUDES = ../ccnl-addons/include ../ccnl-pkt/include ../ccnl-fwd/include ../ccnl-core/include


CC ?= gcc

INCLUDE = include
SRC = src
LIB = lib
OBJ = obj

DIRS = $(OBJ) $(LIB)

INCLUDES += $(INCLUDE)
IFLAGS = $(foreach d,$(INCLUDES),-I$d)
CFLAGS = -Wall -Werror -std=c99 -g $(IFLAGS) $(CCNLCFLAGS)

ARFLAGS = -static -o
AR = libtool

SOURCES=$(wildcard $(SRC)/*.c)
OBJECTS=$(patsubst $(SRC)/%.c, $(OBJ)/%.o, $(SOURCES))

LIBRARY = $(LIB)/$(LIBNAME)

all: ${LIBRARY}

#$(OBJECTS): $(SOURCES) | $(OBJ)
#	 $(CC) $(CFLAGS) -c -o $@ $<
$(OBJ)/%.o: $(SRC)/%.c | $(OBJ)
	$(CC) $(CFLAGS) -c $< -o $@

$(LIBRARY): $(OBJECTS) | $(LIB)
	$(AR) $(ARFLAGS) $@ $(OBJECTS)

$(OBJ):
	mkdir -p $(OBJ)

$(LIB):
	mkdir -p $(LIB)

clean: 
	rm -rf $(DIRS)
